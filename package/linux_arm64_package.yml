ubuntu-arm64:
    image: ubuntu-arm64
    cpus: 4
    memory: 12G
    steps:
    - name: Copy Files
      copy:
        from: ./
        to: vm:~/
        exclude:
            - .git
            - .github
            - docs
            - target

    - name: Install Rust
      run: curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y

    - name: Install Node and NPM
      run: |
        sudo apt update
        sudo apt install  -y -qq nodejs npm

    - name: Install NPM Dependencies
      run: |
        cd web
        npm install

    - name: Build
      run: . "$HOME/.cargo/env" && cargo build --release

    - name: Package
      run: tar czf virtci-linux-arm64.tar.gz -C target/release virtci

    - name: Copy Files
      copy:
        from: vm:~/virtci-linux-arm64.tar.gz
        to: ./
